name: Test the tests!

on:
  push:
    branches: [ main ]
    paths: [ 'ActionsAndTests/**' ]
  workflow_dispatch:

env:
  NET_VERSION: '6.x'
  TEST_PROJECT_PATH: ActionsAndTests/
  TEST_PROJECT_BUILD_PATH: ActionsAndTests/tests
  TEST_PROJECT_NAME: ActionsAndTests
  
jobs:
  my_action_job:
    name: Test the tests!
    runs-on: windows-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v3
        with:
          fetch-depth: 0 # avoid shallow clone so nbgv can do its work.

      - name: Setup .NET SDK ${{ env.NET_VERSION }}
        uses: actions/setup-dotnet@v3
        with:
          dotnet-version: ${{ env.NET_VERSION }}
          dotnet-quality: 'ga'

      - name: 'Resolve Project Dependencies Using Dotnet'
        shell: pwsh
        run: |
          pushd './${{ env.TEST_PROJECT_PATH }}'
          dotnet build --output ./{{ env.TEST_PROJECT_BUILD_PATH }}
          popd

      - name: Run tests
        uses: microsoft-approved-actions/vstest@master
        with:
          testAssembly: ${{ env.TEST_PROJECT_NAME }}*.dll
          searchFolder: ./${{ env.TEST_PROJECT_PATH }}
          runInParallel: true